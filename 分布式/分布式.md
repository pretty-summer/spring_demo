分布式
----------
### 强一致性
````
1） 2pc
2） 3pc
3）XA JTA   DTP   JTA基于DTP规范设计的分布式事务编程接口规范（java-借助框架）
````

### 幂等性
>* db唯一约束（订单号提前生成）
>* token机制 --客户端生成token，服务端teken唯一约束（ 可放redis）
>* 状态机（Tcp,线程的生命周期） update state =2 from tb1 where state =1

````
1，下单场景 同上1，2
2，支付状态控制 同状态机
3，库存扣减(??)
````

### 状态机
>* 实现幂等
>* 通过状态驱动数据变化（驱动业务流程的变化）
>* 业务流程更加清晰



### 弱一致性（base cap）
---最终一致性 借助消息中间件
###### 问题:
````
1，消息重复处理

````
* 1，最大努力通知型  5s 30s 1m 5m 分开通知 --通知最大化场景？？
* 2，消息事件驱动-消息，失败重试 需要保证幂等性

###### mq问题
````
1，消息丢失处理->保证消息投递成功
如果业务处理成功，消息投递失败->借助消息事件表->根据消息事件表投递消息

````
#### 最终一致性实现
* 最大重试（消息时间表），保证消息投递成功
* mq的重试机制（消费失败）

### TCC（应用层）